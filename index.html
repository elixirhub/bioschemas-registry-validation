<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Properties Visualization</title>
    <!-- d3.js framework -->
    <script type="text/javascript" src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="stylesheet.css" media="screen" title="no title" charset="utf-8">
</head>
<body>

    <div id="report_div">
        <p>
            The registry currently contains <span id="tot_props"></span> properties, coming from <span id="tot_websites"></span> websites and belonging to <span id="tot_types"></span> different Bioschemas types.
        </p>
        <p>
            Last registry update: <span id="last_update"></span>.
        </p>
        <p>
            Browse the registry by:
        </p>
    </div>

    <div>
        <button type="button" class="buttons" name="type_btn" onclick="window.location.href='types_registry/index.html'" disabled>Type</button>
        <button type="button" class="buttons" name="web_btn" onclick="window.location.href='websites_registry/index.html'">Website</button>
        <button type="button" class="buttons" name="prop_btn" onclick="window.location.href='properties_registry/index.html'" disabled>Property</button>
    </div>

    <div>
        <p>Or you can validate a URL with the online Bioschemas validator:</p>

        <button type="button" class="buttons" name="val_btn" onclick="window.location.href='validate.html'">Validator</button>
        <button type="button" class="buttons" name="test_btn" onclick="window.location.href='tester.html'">Test a website</button>

    </div>

    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <!--<script type="text/javascript" src="visualizator.js"></script>-->
    <script type="text/javascript">

        window.onload = function () {
            var tot_props = document.getElementById("tot_props");
            var tot_web = document.getElementById("tot_websites");
            var tot_type = document.getElementById("tot_types");
            var last_up = document.getElementById("last_update");

            var typeSet = new Set();
            var propSet = new Set();

            d3.json("registry.json", function (data) {
                var siti = Object.keys(data);
                tot_web.innerHTML = siti.length;
                for (var i in siti) {
                    var primaCella = siti[i];
                    var typeDict = data[primaCella][0];
                    var tipi = Object.keys(typeDict);
                    for (var j in tipi) {
                        var secondaCella = tipi[j];
                        typeSet.add(secondaCella);
                        var toPush = data[primaCella][0][secondaCella];
                        for (var k in toPush) {
                            propSet.add(toPush[k]);
                        }
                    }
                }
                tot_type.innerHTML = Array.from(typeSet).length;
                tot_props.innerHTML = Array.from(propSet).length;
            });

            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth() + 1;
            var yyyy = today.getFullYear();
            if (dd < 10) { dd = '0'+dd; }
            if (mm < 10) { mm = '0'+mm; }

            today = mm + '/' + dd + '/' + yyyy;
            last_up.innerHTML = today;
        };

    </script>

</body>
</html>
