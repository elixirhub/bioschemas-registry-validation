<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Properties Visualization</title>
    <!-- d3.js framework -->
    <script type="text/javascript" src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="../stylesheet.css" media="screen" title="no title" charset="utf-8">
</head>
<body>

    <h2>Browse by Website</h2>

    <table id="web_table" class="tablesorter">
        <thead>
            <tr>
                <th rowspan="2">Website</th>
                <th rowspan="2">Type</th>
                <th colspan="3">Properties</th>
                <th rowspan="2">CV</th>
                <th rowspan="2">Cardinality</th>
            </tr>
            <tr>
                <th>Min</th>
                <th>Rec</th>
                <th>Opt</th>
            </tr>
        </thead>
        <tbody id="types_table">

        </tbody>
    </table>

    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <!-- TableSorter.js -->
    <script type="text/javascript" src="../tablesorter-master/jquery.tablesorter.js"></script>
    <script type="text/javascript" src="../visualizator.js"></script>
    <script type="text/javascript">



        var tableBody = document.getElementById("types_table");

        d3.json("../registry.json", function (data) {

            var siti = Object.keys(data);
            for (var i in siti) {
                var row = tableBody.insertRow(),
                    cell1 = row.insertCell(0),
                    cell2, cell3, cell4, cell5, cell6, cell7;

                var primaCella = siti[i];
                //var linkCella = primaCella.replace(/\./g, "_").replace("_", ".");
                //var cellText1 = document.createElement("a");
                //cellText1.setAttribute("href", "website.html#" + primaCella);
                //cellText1.innerHTML = primaCella;
                var cellText1 = document.createTextNode(primaCella);
                var typeDict = data[primaCella][0];

                var tipi = Object.keys(typeDict);
                var rowSpan = 1;
                if (tipi.length > 1) {
                    rowSpan = tipi.length;
                }

                cell1.appendChild(cellText1);
                cell1.setAttribute("rowspan", rowSpan);

                for (var j in tipi) {
                    if (j < 1) {
                        cell2 = row.insertCell(1);
                        cell3 = row.insertCell(2);
                        cell4 = row.insertCell(3);
                        cell5 = row.insertCell(4);
                        cell6 = row.insertCell(5);
                        cell7 = row.insertCell(6);
                    } else {
                        var newRow = tableBody.insertRow();
                        cell2 = newRow.insertCell(0);
                        cell3 = newRow.insertCell(1);
                        cell4 = newRow.insertCell(2);
                        cell5 = newRow.insertCell(3);
                        cell6 = newRow.insertCell(4);
                        cell7 = newRow.insertCell(5);
                    }

                    var proprieta = [];
                    //var cellText2 = document.createTextNode(tipi[j]);
                    var cellText2 = document.createElement("a");
                    var secondaCella = tipi[j];
                    cellText2.setAttribute("href", "website.html#" + primaCella + "#" + secondaCella);
                    cellText2.innerHTML = secondaCella;

                    cell2.appendChild(cellText2);

                    if (tipi[j] == "Event") {

                        var totMin = 9;
                        var totRec = 13;
                        var totOpt = 11;

                    } else if (tipi[j] == "Organization") {

                        var totMin = 6;
                        var totRec = 11;
                        var totOpt = 11;

                    } else if (tipi[j] == "Person") {

                        var totMin = 2;
                        var totRec = 8;
                        var totOpt = 9;

                    } else if (tipi[j] == "Training") {

                        var totMin = 5;
                        var totRec = 7;
                        var totOpt = 12;

                    }

                    var details = data[primaCella][0][secondaCella][0];
                    var foundMin = details[0];
                    var foundRec = details[1];
                    var foundOpt = details[2];

                    var cellText3 = document.createTextNode(Math.round((foundMin * 100) / totMin) + "%");
                    var cellText4 = document.createTextNode(Math.round((foundRec * 100) / totRec) + "%");
                    var cellText5 = document.createTextNode(Math.round((foundOpt * 100) / totOpt) + "%");

                    cell3.appendChild(cellText3);
                    cell3.style.backgroundColor = colorTable(Math.round((foundMin * 100) / totMin));
                    cell4.appendChild(cellText4);
                    cell4.style.backgroundColor = colorTable(Math.round((foundRec * 100) / totRec));
                    cell5.appendChild(cellText5);
                    cell5.style.backgroundColor = colorTable(Math.round((foundOpt * 100) / totOpt));

                }
            }
        });

        setTimeout(function(){ $("#web_table").tablesorter(); }, 1000);

        function colorTable(val) {
            if (val < 25) {
                return "#FF3333";
            } else if (val >= 25 && val < 50) {
                return "#FF9933";
            } else if (val >= 50 && val < 75) {
                return "#99FF66";
            } else if (val >= 75) {
                return "#33CC66";
            }
        }

    </script>

</body>
</html>
